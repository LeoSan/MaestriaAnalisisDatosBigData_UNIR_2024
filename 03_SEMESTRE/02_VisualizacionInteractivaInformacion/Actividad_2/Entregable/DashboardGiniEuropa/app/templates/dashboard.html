{% extends "base.html" %}

{% block content %}
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
<script src="{{ url_for('static', filename='js/utils.js') }}"></script>

<div class="space-y-8">
    <div
        class="bg-white p-6 rounded-lg shadow-md border-l-4 {% if stats %}border-green-500{% else %}border-red-500{% endif %}">
        <h1 class="text-2xl font-bold text-gray-800">{{ "analisis de los datos y validación del mismo." | capitalize }}
        </h1>
    </div>

    {% if stats %}
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div class="bg-blue-50 p-4 rounded shadow text-center">
            <div class="text-3xl font-bold text-blue-700">{{ stats.total_records }}</div>
            <div class="text-sm text-blue-600">Registros Limpios</div>
        </div>
        <div class="bg-blue-50 p-4 rounded shadow text-center">
            <div class="text-3xl font-bold text-blue-700">{{ stats.countries_count }}</div>
            <div class="text-sm text-blue-600">Países Europeos</div>
        </div>
        <div class="bg-blue-50 p-4 rounded shadow text-center">
            <div class="text-3xl font-bold text-blue-700">{{ stats.year_min }} - {{ stats.year_max }}</div>
            <div class="text-sm text-blue-600">Rango Temporal</div>
        </div>
    </div>

    <!-- <div class="bg-white rounded-lg shadow overflow-hidden">
        <div class="px-6 py-4 border-b">
            <h3 class="font-bold text-gray-700">Muestra de Datos Procesados (Primeros 5 registros)</h3>
        </div>
        <table class="w-full text-left text-sm text-gray-600">
            <thead class="bg-gray-100 uppercase font-medium">
                <tr>
                    <th class="px-6 py-3">País</th>
                    <th class="px-6 py-3">Año</th>
                    <th class="px-6 py-3">Índice Gini</th>
                </tr>
            </thead>
            <tbody>
                {% for row in stats.sample_data %}
                <tr class="border-b hover:bg-gray-50">
                    <td class="px-6 py-3 font-medium text-gray-900">{{ row['Country Name'] }}</td>
                    <td class="px-6 py-3">{{ row['Year'] }}</td>
                    <td class="px-6 py-3 text-blue-600 font-bold">{{ row['Gini'] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div> -->
    {% endif %}


    <div class="bg-white p-6 rounded-lg shadow border-l-4 border-indigo-500">
        <h1 class="text-2xl font-bold text-gray-800">Parte 1: Evolución de la Desigualdad</h1>
        <p class="text-gray-600 mt-2">
            Comparativa entre una visualización ética y una manipulada, según requerimientos del ejercicio.
        </p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

        <div class="bg-white p-4 rounded-lg shadow-lg">
            <h2 class="text-lg font-bold text-green-700 mb-2 border-b pb-2">✅ Visualización Ética</h2>
            <p class="text-sm text-gray-500 mb-4 h-12">
                Usa una escala Y razonable (20-45) y colores distintivos. Permite ver que las tendencias son suaves y
                estables en la mayoría de países.
            </p>
            <div id="chart-correct" class="w-full h-80"></div>
        </div>

        <div class="bg-white p-4 rounded-lg shadow-lg border-2 border-red-100">
            <h2 class="text-lg font-bold text-red-700 mb-2 border-b pb-2">❌ Visualización Manipulada</h2>
            <p class="text-sm text-gray-500 mb-4 h-12">
                <b>Errores intencionales:</b> Eje Y truncado (hace zoom extremo) y paleta de colores monócroma. Parece
                que la desigualdad fluctúa violentamente.
            </p>
            <div id="chart-manipulated" class="w-full h-80"></div>
        </div>

    </div>

    <hr class="border-t-2 border-gray-200 my-10">

    <div class="bg-white p-6 rounded-lg shadow border-l-4 border-purple-500 mb-8">
        <h1 class="text-2xl font-bold text-gray-800">Parte 2: Interpretación en Contexto</h1>
        <p class="text-gray-600 mt-2">
            Análisis de similitudes y relación con variables macroeconómicas (PIB).
        </p>
    </div>

    <h3 class="text-xl font-bold text-gray-700 mb-4">2.1 Identificación de Patrones</h3>
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">
        <div class="bg-white p-4 rounded-lg shadow-lg">
            <h2 class="text-lg font-bold text-green-700 mb-2 border-b pb-2">✅ Enfoque (Storytelling)</h2>
            <p class="text-xs text-gray-500 mb-2">Destacamos solo 2 países opuestos, dejando el resto en gris como
                contexto.</p>
            <div id="chart-div-correct" class="w-full h-80"></div>
        </div>
        <div class="bg-white p-4 rounded-lg shadow-lg border-2 border-red-100">
            <h2 class="text-lg font-bold text-red-700 mb-2 border-b pb-2">❌ Spaghetti Chart</h2>
            <p class="text-xs text-gray-500 mb-2">Intentar mostrar todo a la vez hace imposible el análisis.</p>
            <div id="chart-div-bad" class="w-full h-80"></div>
        </div>
    </div>

    <h3 class="text-xl font-bold text-gray-700 mb-4">2.2 Variables Subyacentes (PIB)</h3>
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="bg-white p-4 rounded-lg shadow-lg">
            <h2 class="text-lg font-bold text-green-700 mb-2 border-b pb-2">✅ Scatter Plot (Gini vs PIB)</h2>
            <p class="text-xs text-gray-500 mb-2">Revela que países ricos y pobres pueden tener el mismo Gini.</p>
            <div id="chart-context-correct" class="w-full h-80"></div>
        </div>
        <div class="bg-white p-4 rounded-lg shadow-lg border-2 border-red-100">
            <h2 class="text-lg font-bold text-red-700 mb-2 border-b pb-2">❌ Ranking Simple</h2>
            <p class="text-xs text-gray-500 mb-2">Oculta la realidad económica detrás del número.</p>
            <div id="chart-context-bad" class="w-full h-80"></div>
        </div>
    </div>
</div>

<script type="text/javascript">

    // 1. Recibimos los strings JSON crudos desde Flask (usando el filtro safe)
    const rawJsonCorrect = {{ charts.evolution_correct | safe }};
    const rawJsonManipulated = {{ charts.evolution_manipulated | safe }};

    // 2. Ejecutamos el renderizado
    renderChart('chart-correct', rawJsonCorrect);
    renderChart('chart-manipulated', rawJsonManipulated);

    // NUEVAS GRÁFICAS PARTE 2

    renderChart('chart-div-correct', {{ charts.divergence_correct | safe }});
    renderChart('chart-div-bad', {{ charts.divergence_bad | safe }});


    renderChart('chart-context-correct', {{ charts.context_correct | safe }});
    renderChart('chart-context-bad', {{ charts.context_bad | safe }});

</script>
{% endblock %}